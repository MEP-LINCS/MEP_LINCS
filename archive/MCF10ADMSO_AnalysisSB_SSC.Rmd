
---
title: MEP-LINCS MCF10A DMSO Analysis 
author: Mark Dane

output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    source_code: embed
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE)

```


```{r functions}
#Author: Mark Dane, copyright 2016
#Run from MEP-LINCS/MEP_LINCS/Release

datasetName <- "MCF10ADMSO"
cellLine <- "MCF10A"
ss <- "SSF"
drug<- "none"
rawDataVersion <- "v2"
analysisVersion <- "av1.7"

source("/graylab/share/dane/MEP-LINCS/MEP_LINCS/Release/MEPLINCSFunctions.R")
source("/graylab/share/dane/MEP-LINCS/MEP_LINCS/Release/MEP-LINCS QANorm Functions.R")

createPCAModel <- function(dt,fvNames){
  #delete any non-varying signals that cannot be scaled to unit variance
  stdDevs <- apply(dt[,fvNames, with=FALSE], 2, sd)
  if(any(stdDevs==0))  cat(paste("Deleting",fvNames[stdDevs==0], "due to 0 variance\n"))
  fvNames <- fvNames[!stdDevs==0]
  PCAModel <- prcomp(as.formula(paste(" ~ ", paste(fvNames, collapse = "+"))), data = dt, scale.= TRUE)
  rownames(PCAModel$x)<-paste(dt$MEP,gsub("LI8X00","",dt$Barcode), sep="_")
  return(PCAModel)
}

plotPCs <- function(m, PCs, colour, title, legendTitle, xlim=NULL, ylim=NULL, colorByCtrls=TRUE, highlightName=NULL){
  if(!(length(PCs)==3&class(m)=="prcomp")) stop("PCs must have a length of 3 and m must be of class prcomp")
  
  if(is.null(highlightName)){
    p12 <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[2], colour = colour)) +
      geom_point(size = rel(.5), alpha = .5) +
      labs(colour = legendTitle)+
      ggtitle(title)+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
    
    p23 <- ggplot(data.frame(m$x), aes_string(x = PCs[2], y = PCs[3], colour = colour)) +
      geom_point(size = rel(.5), alpha = .5) +
      labs(colour = legendTitle)+
      ggtitle(title)+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
    
    p13 <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[3], colour = colour)) +
      geom_point(size = rel(.5), alpha = .5) +
      labs(colour = legendTitle)+
      ggtitle(title)+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
    
  } else {
    #Dim out all MEPs except the selected
    dimColour<-"cornflowerblue"
    p12 <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[2])) +
      geom_point(size = rel(.5), alpha = .5, colour = dimColour) +
      labs(colour = legendTitle)+
      ggtitle(paste(title, "with",highlightName, "highlighted"))+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
    
    p23 <- ggplot(data.frame(m$x), aes_string(x = PCs[2], y = PCs[3])) +
      geom_point(size = rel(.5), alpha = .5, colour = dimColour) +
      labs(colour = legendTitle)+
      ggtitle(paste(title, "with",highlightName, "highlighted"))+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
    
    p13 <- ggplot(data.frame(m$x), aes_string(x = PCs[1], y = PCs[3])) +
      geom_point(size = rel(.5), alpha = .5, colour = dimColour) +
      labs(colour = legendTitle)+
      ggtitle(paste(title, "with",highlightName, "highlighted"))+
      guides(colour=FALSE)+
      coord_cartesian(xlim=xlim, ylim=ylim)+
      theme(legend.text=element_text(size = 6),
            plot.title=element_text(size = rel(.7)))
  }
  
  if(colorByCtrls){
    p12 <- p12 + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.5), alpha = .4)
    p12 <- p12 + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="chocolate",size = rel(.5), alpha = .4)
    p23 <- p23 + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.5), alpha = .4)
    p23 <- p23 + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="chocolate",size = rel(.5), alpha = .4)
    p13 <- p13 + geom_point(data=data.frame(m$x[grepl("FBS",rownames(m$x)),]),colour="black",size = rel(.5), alpha = .4)
    p13 <- p13 + geom_point(data=data.frame(m$x[grepl("NID1",rownames(m$x)),]),colour="chocolate",size = rel(.5), alpha = .4)
  }
  
  if(!is.null(highlightName)){
    p12 <- p12 + geom_point(data=data.frame(m$x[grepl(highlightName,rownames(m$x)),]),colour="gold",size = rel(.5), alpha = .8)
    p23 <- p23 + geom_point(data=data.frame(m$x[grepl(highlightName,rownames(m$x)),]),colour="gold",size = rel(.5), alpha = .8)
    p13 <- p13 + geom_point(data=data.frame(m$x[grepl(highlightName,rownames(m$x)),]),colour="gold",size = rel(.5), alpha = .8)
  }
  
  print(p12)
  print(p23)
  print(p13)
  
}

plotScree <- function(m,nrPCs=9,main  = paste("PCA Scree Plot for",cellLine,ss)){
  var <- m$sd[1:nrPCs]^2
  var.percent <- var/sum(var) * 100
  barplot(var.percent, xlab="PC", ylab="Percent Variance", names.arg=1:length(var.percent), las=1, ylim=c(0,max(var.percent)), col="gray", main=main)
}

shortenHA <- function(x){
  x$ECMp <- gsub("hyaluronicacid","HA",x$ECMp)
  x$ECMp <- gsub("lessthan","<",x$ECMp)
  x$ECMp <- gsub("greaterthan",">",x$ECMp)
  x$MEP <- paste(x$ECMp,x$Ligand,sep = "_")
  return(x)
}
#Add an index for the plate in the ligand set
addLigandPlate <- function(dt){
  
}
addOmeroIDs <- function(dt){
  if(any(grepl("^ImageID$",colnames(dt)))){
    dt <- dt[,OmeroDetailURL := paste0('<a href="https://meplincs.ohsu.edu/webclient/img_detail/',ImageID,'/"',' target="_blank">Omero</a>')]
    dt <- dt[,OmeroThumbnailURL := paste0('<a href="https://meplincs.ohsu.edu/webclient/render_thumbnail/',ImageID,'/"',' target="_blank">Omero</a>')]
    dt <- dt[,OmeroImageURL := paste0('<a href="https://meplincs.ohsu.edu/webclient/render_image/',ImageID,'/"',' target="_blank">Omero</a>')]
  }
  return(dt)
}

create8WellPseudoImage <- function(DT, pr, prDisplay,highThresh = .99, lowThresh = .01, highThreshValue=NULL, lowThreshValue=NULL){
  #find high and low values
  if(is.null(highThreshValue)) highThreshValue<-quantile(DT[[pr]],probs = highThresh,na.rm=TRUE)
  if(is.null(lowThreshValue)) lowThreshValue<-quantile(DT[[pr]],probs = lowThresh,na.rm=TRUE)
  p <- ggplot(DT, aes_string(x="ArrayColumn", y="ArrayRow",colour=pr))+
    geom_point(size=rel(.25))+
    scale_y_reverse()+   scale_x_continuous(breaks= c(min(DT$ArrayColumn),round(mean(c(min(DT$ArrayColumn),max(DT$ArrayColumn)))),max(DT$ArrayColumn)))+
    scale_colour_gradient(low = "white", high = "red", limits=c(lowThreshValue, highThreshValue), oob=squish)+
    guides(colour = guide_legend(prDisplay, keywidth = .5, keyheight = .5))+
    ggtitle(paste("\n\n",prDisplay,"for",unique(DT$CellLine), "cells \nin plate",unique(DT$Barcode)))+
    xlab("")+ylab("")+
    theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)),
          axis.title.x = element_text(size=rel(.5)),
          plot.title = element_text(size = rel(.8)),
          strip.text = element_text(size = rel(.5)),
          legend.text=element_text(size = rel(.4)),legend.title=element_text(size = rel(.3)))+
    facet_wrap(~Well_Ligand, ncol=4)
}
medianSummarizel4 <- function(dt){
  #median summarize the MEP replicates in a datatable
  #Select all signal names and the minimal metadata
  dtNames <- grep("^Ligand$|^ECMp$|MEP|^Well$|_CP_|_PA_",x = names(dt), value = TRUE)
  
  #Create a datatable of the signals and minimal metadata
  dtKeep <- dt[, dtNames, with = FALSE]
  dtMedians <- dtKeep[, lapply(.SD, numericMedian), keyby = "Ligand,ECMp,MEP,Well"]
  return(dtMedians)
}

meanSummarizel4 <- function(dt){
  #median summarize the MEP replicates in a datatable
  #Select all signal names and the minimal metadata
  dtNames <- grep("^Ligand$|^ECMp$|MEP|^Well$|_CP_|_PA_",x = names(dt), value = TRUE)
  
  #Create a datatable of the signals and minimal metadata
  dtKeep <- dt[, dtNames, with = FALSE]
  dtMeans <- dtKeep[, lapply(.SD, numericMean), keyby = "Ligand,ECMp,MEP,Well"]
  return(dtMeans)
}

meanSummarizel3 <- function(dt){
  #median summarize the Spot replicates in a datatable
  #Select all signal names and the minimal metadata
  dtNames <- grep("^Ligand$|^ECMp$|MEP|^Well$|PrintSpot|_CP_|_PA_",x = names(dt), value = TRUE)
  
  #Create a datatable of the signals and minimal metadata
  dtKeep <- dt[, dtNames, with = FALSE]
  dtMeans <- dtKeep[, lapply(.SD, numericMean), keyby = "Ligand,ECMp,MEP,Well,PrintSpot"]
  return(dtMeans)
}

numericMean <- function(x){
  as.numeric(mean(x, na.rm=TRUE))
}

classifySCCQuartiles <- function(x){
  xf <- factor(rep("Q1",length(x)),levels=c("Q1","Q2","Q3","Q4"), ordered=TRUE)
  xNr <- length(x)
  qs <- quantile(x, probs=c(.25, .5, .75))
  xf[x<=qs[1]] <- "Q1"
  xf[qs[1]<x&x<=qs[2]] <- "Q2"
  xf[qs[2]<x&x<=qs[3]] <- "Q3"
  xf[qs[3]<x] <- "Q4"
  return(xf)
}

panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  r <- abs(cor(x, y))
  txt <- format(c(r, 0.123456789), digits = digits)[1]
  txt <- paste0(prefix, txt)
  if(missing(cex.cor)) cex.cor <- .8/strwidth(txt)
  text(0.5, 0.5, txt, cex=cex.cor)
}

panel.hist <- function(x, ...)
{
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5) )
  h <- hist(x, plot = FALSE)
  breaks <- h$breaks; nB <- length(breaks)
  y <- h$counts; y <- y/max(y)
  rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}

createl4WithReps <- function (l3) {
  #Select all signal names and the minimal metadata
  l4Names <- grep("^Ligand$|^ECMp$|MEP|StainingSet|_CP_|_PA_",x = names(l3), value = TRUE)
  #Remove the SE names
  l4Names <- grep("_SE", l4Names, value = TRUE, invert = TRUE)
  #Create a datatable of the signals and minimal metadata
  l4Keep <- l3[, l4Names, with = FALSE]
  l4DT <- l4Keep[, lapply(.SD, numericMedian), keyby = "Ligand,ECMp,MEP,StainingSet"]
  return(l4DT)
}

```


```{r setup}

library("ggplot2")
library(scales)
library("data.table")
library("MEMA")
library("grid")
library("knitr")
library("gplots")
library("RColorBrewer")
library(DT)
library(d3heatmap)
library(plotly)
library(corrplot)
library(RUVnormalize)
library(ruv)
library(Rtsne)
library(XLConnect)


#Setup colors for Barcode and text in all heatmaps
selDark2 <- colorRampPalette(brewer.pal(8,"Dark2"))
plateCol <- selDark2(8)
hmcols<-colorRampPalette(c("blue","white","red"))(16)

PCAOnly <- TRUE
if(cellLine=="MCF10A"){
  ssNr <- 3
} else {
  ssNr <- 2
}


#Read in the data.table that holds every spot in the DMSO experiment
l3 <- shortenHA(fread(paste0("/graylab/share/dane/MEP-LINCS/MEP_LINCS/AnnotatedData/",datasetName, "_",ss,"_Level3.txt"), showProgress = FALSE))
l3$StainingSet <- ss

#Add SCC Bins
nrBreaks <- 50
l3 <- l3[,SCCBin := round(2^ave(l3$Spot_PA_SpotCellCountLog2, cut(l3$Spot_PA_SpotCellCountLog2, breaks=nrBreaks), FUN=median))]

#Add the ranking based on SCC within each well and ECMp
l3$EB <- paste(l3$ECMp,l3$SCCBin,sep="_")

l3$WL <- paste(l3$Well,l3$Ligand,sep="_")
l3$BWL <- paste(l3$Barcode,l3$Well,l3$Ligand,sep="_")
l3 <- l3[,Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed:= btLogit(Nuclei_PA_Cycle_DNA2NProportionLogit)]
l3 <- l3[,Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed:= btLogit(Nuclei_PA_Gated_EdUPositiveProportionLogit)]
l4 <- createl4KeepRaw(l3)

#Create l3 and l4 datasets with a few bins
fewBreaks <- 5
l3fb <- copy(l3)
l3fb <- l3fb[,SCCBin := round(2^ave(l3fb$Spot_PA_SpotCellCountLog2, cut(l3fb$Spot_PA_SpotCellCountLog2, breaks=fewBreaks), FUN=median))]
l4fb <- rbindlist(lapply(unique(l3fb$SCCBin), function(bin){
  dt <- l3fb[l3fb$SCCBin==bin,]
  dt <- createl4WithReps(dt)
  dt$SCCBin <- bin
  return(dt)
}))
l4fb$MB <- paste(l4fb$MEP,l4fb$SCCBin,sep="_")

#Load MCF10A MEMA data to compare
MEMArepDT <- fread("/graylab/share/dane/MEP-LINCS/MEP_LINCS/AnnotatedData/MCF10A_SSC_Level4.txt", showProgress=FALSE, verbose = FALSE)
MEMArepDT <- MEMArepDT[,lapply(.SD,numericMedian), by=Ligand, .SDcols=c("Spot_PA_SpotCellCountLog2","Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess","Nuclei_PA_Cycle_DNA2NProportionLogitRUVLoess")]

```

###Introduction

```{r, fig.width=7, fig.height=5}
p <- ggplot(l3, aes(x=Spot_PA_SpotCellCount, fill=Barcode))+
  geom_density(alpha=.3)+
  xlab("Spot Cell Count")+
  ggtitle("Spot Cell Count Distributions\n by 8 Well Plate")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)))
p
p <- ggplot(l3, aes(x=Spot_PA_SpotCellCount, fill=Well))+
  geom_density(alpha=.3)+
  facet_wrap(~Barcode, ncol = 4)+
  xlab("Spot Cell Count")+
  ggtitle("Spot Cell Count Distributions\n by 8 Well Plate and Well")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)))
p
p <- ggplot(l3, aes(x=Barcode, y=Spot_PA_SpotCellCount))+
  geom_boxplot()+
  xlab("Barcode")+
  ylab("Spot Cell Count")+
  ggtitle("Spot Cell Count Boxplots\n by 8 Well Plate")+
  guides(colour=FALSE)+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)))
p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.1)
p
p <- ggplot(l3, aes(x=Well, y=Spot_PA_SpotCellCount, fill=Ligand))+
  geom_boxplot(alpha=.5)+
  facet_wrap(~Barcode,ncol = 4)+
  xlab("Well")+
  ylab("Spot Cell Count")+
  ggtitle("Spot Cell Count Boxplots\n by 8 Well Plate and Well")+
  guides(colour=FALSE)+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(.5)),legend.title=element_text(size = rel(.5)))
p <- p +  geom_jitter(aes(colour=ECMp),colour="black",size=rel(.05),alpha=.1)
p
```

***
This analysis explores the MEP-LINCS experiment which used `r unique(l3$CellLine)` cells in `r length(unique(l3$Barcode))` plates. The median of the spot cell counts is `r median(l3$Spot_PA_SpotCellCount)` and the range is `r range(l3$Spot_PA_SpotCellCount)`.

There are `r length(unique(l3$Ligand))` different ligands. MEMA arrays with `r length(unique(l3$ECMp))` ECM proteins are printed in each well.

This analysis explores the BMP High-Replicate experiment which used `r unique(l3$CellLine)` cells in `r length(unique(l3$Barcode))` plates. The median of the spot cell counts is `r median(l3$Spot_PA_SpotCellCount)` and the range is `r range(l3$Spot_PA_SpotCellCount)`.

There are `r length(unique(l3$Ligand))` different ligands in replicate wells within and across the plates. MEMA arrays with `r length(unique(l3$ECMp))` ECM proteins are printed in each well.

###High-Rep Proliferation Boxplots by Cell Count Bin, Well and Plate

```{r, fig.width=10, fig.height=7, eval=TRUE}

dt <- l3fb[SCCBin>20,]
p <- ggplot(dt, aes(x=factor(SCCBin), y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed, fill=Well))+
  geom_boxplot()+
  facet_grid(Barcode~Ligand)+
  #coord_cartesian(xlim=c(0,.75))+
  xlab("Spot Cell Count Bin")+
  ylab("EdU+ Proportion")+
  ggtitle("Proliferation Boxplots")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
p <- p +  geom_jitter(aes(colour=ECMp),colour="black",size=rel(.05),alpha=.1)
print(p)

```

***
These density plots show the distributions of the proliferation values in all wells of the plates. The lowest cell count bins were filtered from the figures due to noisy values. Each dot in the boxplots represents data from one MEMA spot.

###FBS proliferation correlations in bins across plates

```{r, fig.width=6, fig.height=6, eval=TRUE}
dt <- l3fb[SCCBin>20,]
dt <- dt[grepl("FBS",Ligand),]
dt <- dt[grepl("COL1",ECMp),]
dt$Ligand <- gsub("_P.","",dt$Ligand)
for(sb in sort(unique(dt$SCCBin))){
  dtb <- dt[SCCBin==sb,]
  dtc <- dcast(dt,Ligand+SCCBin~Barcode,fun.aggregate = median, value.var = "Nuclei_PA_Gated_EdUPositiveProportion", fill=NA)
  
  p <- pairs(~LI8X00721+LI8X00722+LI8X00723+LI8X00724+LI8X00725+LI8X00726+LI8X00727+LI8X00728,data=dtc, main=paste("Proliferation Correlations Across Plates\nin All Bins"),lower.panel = panel.smooth, upper.panel = panel.cor, na.action = na.exclude, span=1, cex.main=.5, pch=20, col = alpha("blue", 0.2))
}
```

***
These correlation matrix figures compare the proliferation of spots with similar cell counts and exposed to the same ligand but in different plates. 

- Each of the `r nrow(dtc)` circles in the panels represents the median proliferation of a spot cell count bin for FBS in a plate. 

- Data from `r length(unique(dt$SCCBin))` bins centered between `r range(dt$SCCBin)` cells per spot are shown in this figure

- Pearson r values are shown in the upper triangle

###MCF10A DMSO proliferation correlations of MEPs within plates

```{r, fig.width=8, fig.height=8, eval=TRUE}
dt <- l3fb[SCCBin>20,]
dt <- dt[grepl("FBS",Ligand),]
dt$Ligand <- gsub("_P.","",dt$Ligand)
dt$MEP <- gsub("_P.","",dt$MEP)
for(sb in sort(unique(dt$SCCBin))){
  dtb <- dt[SCCBin==sb,]
  dtc <- dcast(dtb,MEP+SCCBin~Barcode,fun.aggregate = median, value.var = "Nuclei_PA_Gated_EdUPositiveProportion", fill=NA)
  
  p <- pairs(~LI8X00721+LI8X00722+LI8X00723+LI8X00724+LI8X00725+LI8X00726+LI8X00727+LI8X00728,data=dtc, main=paste("Proliferation Correlations of MEPs Across Plates\nin the",sb,"Bin"),lower.panel = panel.smooth, upper.panel = panel.cor, na.action = na.exclude, span=1, cex.main=.5, pch=20, col = alpha("blue", 0.2))
}
```

***
These correlation matrix figures compare the proliferation of MEPs with similar cell counts in different plates. 

- Each of the `r nrow(dtc)` circles in the panels represents the median proliferation of a MEP in the labeled spot cell count bin. 

- Each figure shows data from one bin

- Pearson r values are shown in the upper triangle

###Signals summarized by MEP and `r length(unique(l4fb$SCCBin))` SCC Bins

```{r MEPSCCBinVisuals, fig.width=7, fig.height=5}
p <- ggplot(l4fb, aes(x=factor(SCCBin)))+
  geom_bar()+
  guides(colour=FALSE)+
  xlab("Spot Cell Count (SCC) Bins")+
  ylab("MEP Count in Each Bin")+
  ggtitle("Distribution of MEPs in the SCC Bins")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
p

p <- ggplot(l4fb, aes(x=factor(SCCBin), y=Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed))+
  geom_boxplot(outlier.colour = NA)+
  guides(colour=FALSE)+
  xlab("Spot Cell Count Bins")+
  ylab("DNA 2n Proportion (raw)")+
  ggtitle("2n Cell Cycle Proportion in MEPs with Similar Cell Counts")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.3),alpha=.4)
p

if(ss %in% c("SS2","SS4")){
  p <- ggplot(l4fb, aes(x=factor(SCCBin), y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    labs(title="Proliferation in MEPs with Similar Cell Counts", x="Spot Cell Count Bins", y="EdU+ Proportion (raw)")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.3),alpha=.4)
  p
  
}

if(ss %in% c("SS3","SS4")){
  p <- ggplot(l4fb, aes(x=factor(SCCBin), y=Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    labs(title="KRT5 Intensity in MEPs with Similar Cell Counts", x="Spot Cell Count Bins", y="KRT5 Median Intensity")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.3),alpha=.4)
  p
}

if(ss %in% c("SS3","SS4")){
  p <- ggplot(l4fb, aes(x=factor(SCCBin), y=Cytoplasm_CP_Intensity_MedianIntensity_KRT19Log2))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    labs(title="KRT19 Intensity in MEPs with Similar Cell Counts", x="Spot Cell Count Bins", y="KRT19 Median Intensity")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.3),alpha=.4)
  p
}

```

***
These figures show the data binned into `r length(unique(l4fb$SCCBin))` bins and then median summarized by the ECM protein and ligand combinations. There are `r length(unique(l4fb$MEP))` different MEPs that could be in each bin but not all combinations are present and the total number of MEPs in the `r length(unique(l4fb$SCCBin))`  bins is `r length(unique(l4fb$MB))`.

###DNA 2n Proportion by SCC Bin and Ligand

```{r DNA2nSCCLigand, fig.width=16, fig.height=6}
for(i in 1:(length(unique(l3fb$Ligand))/16)){
  ligands <- unique(l3fb$Ligand)[(((i-1)*16)+1):(i*16)]
  dt <- l3fb[l3fb$Ligand %in% ligands,]
  p <- ggplot(dt, aes(x=factor(SCCBin), y=Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed))+
    geom_boxplot(outlier.colour = NA)+
    facet_wrap(~Ligand,ncol=4)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("DNA 2n Proportion (raw)")+
    ggtitle("2n Cell Cycle Proportion in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  #p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  print(p)
}


```

***
These boxplots stratify the spots by SCC bin and ligand. The boxplots combine all ECM proteins combined with the labeled ligand.


###Proliferations by SCC Bin and Ligand

```{r EdUSCCLigand, fig.width=16, fig.height=6}
for(i in 1:(length(unique(l3fb$Ligand))/16)){
  ligands <- unique(l3fb$Ligand)[(((i-1)*16)+1):(i*16)]
  dt <- l3fb[l3fb$Ligand %in% ligands,]
  p <- ggplot(dt, aes(x=factor(SCCBin), y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed))+
    geom_boxplot(outlier.colour = NA)+
    facet_wrap(~Ligand,ncol=4)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("EdU+ Proportion (raw)")+
    ggtitle("Proliferation in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  #p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  print(p)
}


```

***
These boxplots stratify the spots by SCC bin and ligand. The boxplots combine all ECM proteins combined with the labeled ligand.

###KRT5 by SCC Bin and Ligand

```{r KRT5SCCLigand, fig.width=16, fig.height=6}
for(i in 1:(length(unique(l3fb$Ligand))/16)){
  ligands <- unique(l3fb$Ligand)[(((i-1)*16)+1):(i*16)]
  dt <- l3fb[l3fb$Ligand %in% ligands,]
  p <- ggplot(dt, aes(x=factor(SCCBin), y=Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2))+
    geom_boxplot(outlier.colour = NA)+
    facet_wrap(~Ligand,ncol=4)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("KRT5 Median Intensity")+
    ggtitle("KRT5 Intensity in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  #p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  print(p)
}


```

***
These boxplots stratify the spots by SCC bin and ligand. The boxplots combine all ECM proteins combined with the labeled ligand.

###Signals detailed by MEP and `r length(unique(l4fb$SCCBin))` SCC Bins

```{r MEPSCCBinSIgnals, fig.width=7, fig.height=5}
p <- ggplot(l4fb,
            aes(x=reorder(MEP, Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed),
                y=Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed,
                colour=factor(SCCBin)))+
  geom_point(size=rel(.3),
             alpha=.5)+
  labs(title="2n Cell Cycle Proportion in MEPs with Similar Cell Counts",
       x="MEP",
       y="DNA 2n Proportion (raw)",
       colour="SCC Bin")+
  theme( axis.text.x=element_blank(),
         axis.ticks=element_blank(),
         panel.grid.major = element_blank())
p

if(ss %in% c("SS2","SS4", "SSF")){
  p <- ggplot(l4fb,
              aes(x=reorder(MEP,Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed),
                  y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed,
                  colour=factor(SCCBin)))+
    geom_point(size=rel(.3),
               alpha=.5)+
    labs(title="Proliferation in MEPs with Similar Cell Counts",
         x="MEP",
         y="EdU+ Proportion (raw)",
         colour="SCC Bin")+
    theme( axis.text.x=element_blank(),
           axis.ticks=element_blank(),
           panel.grid.major = element_blank())
  p
  
}

if(ss %in% c("SS3","SS4", "SSF")){
  p <- ggplot(l4fb,
              aes(x=reorder(MEP, Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2),
                  y=Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2,
                  colour=factor(SCCBin)))+
    geom_point(size=rel(.3),
               alpha=.5)+
    labs(title="KRT5 Intensity in MEPs with Similar Cell Counts",
         x="MEP",
         y="KRT5 Median Intensity",
         colour="SCC Bin")+
    theme( axis.text.x=element_blank(),
           axis.ticks=element_blank(),
           panel.grid.major = element_blank())
  p
}

if(ss %in% c("SS3","SS4")){
  p <- ggplot(l4fb,
              aes(x=reorder(MEP, Cytoplasm_CP_Intensity_MedianIntensity_KRT19Log2),
                  y=Cytoplasm_CP_Intensity_MedianIntensity_KRT19Log2,
                  colour=factor(SCCBin)))+
    geom_point(size=rel(.3),
               alpha=.5)+
    labs(title="KRT19 Intensity in MEPs with Similar Cell Counts",
         x="MEP",
         y="KRT19 Median Intensity",
         colour="SCC Bin")+
    theme( axis.text.x=element_blank(),
           axis.ticks=element_blank(),
           panel.grid.major = element_blank())
  p
}

```

***
These figures show MEP summarized and cell count binned signals.The MEPs are ordered by the mean of all bins.  

###Signals detailed by MEP and `r length(unique(l4fb$SCCBin))` SCC Bins

```{r MEPSCCBinDNA2n, fig.width=7, fig.height=5}
p <- ggplot(l4fb, aes(x=reorder(MEP, Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed), y=Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed, colour=factor(SCCBin)))+
  geom_point(size=rel(1), alpha=.5)+
  labs(title="2n Cell Cycle Proportion in MEPs with Similar Cell Counts",
       x="MEP",
       y="DNA 2n Proportion (raw)",
       colour="SCC Bin")+
  theme( axis.text.x=element_blank(), axis.ticks=element_blank(),  panel.grid.major = element_blank())
ggplotly(p)


```

***
This figure shows the DNA 2n values MEP summarized and cell count binned.The MEPs are ordered by the mean of all bins.  

###Proliferation detailed by MEP and `r length(unique(l4fb$SCCBin))` SCC Bins

```{r MEPSCCBinEdU, fig.width=7, fig.height=5}

if(ss %in% c("SS2","SS4", "SSF")){
  p <- ggplot(l4fb, aes(x=reorder(MEP, Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed), y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed, colour=factor(SCCBin)))+
    geom_point(size=rel(1), alpha=.5)+
    labs(title="Proliferation in MEPs with Similar Cell Counts",
         x="MEP",
         y="EdU+ Proportion (raw)",
         colour="SCC Bin")+
    theme( axis.text.x=element_blank(), axis.ticks=element_blank(),  panel.grid.major = element_blank())
  ggplotly(p)
  
}
```

***
This figure shows the proliferation values MEP summarized and cell count binned.The MEPs are ordered by the mean of all bins.  

###KRT5 Intensity detailed by MEP and `r length(unique(l4fb$SCCBin))` SCC Bins

```{r MEPSCCBinKRT5, fig.width=7, fig.height=5}


if(ss %in% c("SS2","SS4", "SSF")){
  p <- ggplot(l4fb, aes(x=reorder(MEP, Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2), y=Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2, colour=factor(SCCBin)))+
    geom_point(size=rel(1), alpha=.5)+
    labs(title="KRT5 Intensity in MEPs with Similar Cell Counts",
         x="MEP",
         y="KRT5 Median Intensity",
         colour="SCC Bin")+
    theme( axis.text.x=element_blank(), axis.ticks=element_blank(),  panel.grid.major = element_blank())
  
  ggplotly(p)
}

```

***
This figure shows the KRT5 values MEP summarized and cell count binned. The MEPs are ordered by the mean of all bins.  


###Spot Cell Count Binning assigns each spot to a bin with similar cell counts.

```{r SCCBinVisuals, fig.width=7, fig.height=5}
p <- ggplot(l3, aes(x=factor(SCCBin)))+
  geom_bar()+
  guides(colour=FALSE)+
  xlab("Spot Cell Count (SCC) Bins")+
  ylab("Spot Count in Each Bin")+
  ggtitle("Distribution of Spots in the SCC Bins")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
p

p <- ggplot(l3, aes(x=factor(SCCBin), y=Nuclei_PA_Cycle_DNA2NProportionLogitBacktransformed))+
  geom_boxplot(outlier.colour = NA)+
  guides(colour=FALSE)+
  xlab("Spot Cell Count Bins")+
  ylab("DNA 2n Proportion (raw)")+
  ggtitle("2n Cell Cycle Proportion in Spots with Similar Cell Counts")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
p

if(ss %in% c("SS2","SS4", "SSF")){
  p <- ggplot(l3, aes(x=factor(SCCBin), y=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("EdU+ Proportion (raw)")+
    ggtitle("Proliferation in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  p
  
}

if(ss %in% c("SS3","SS4", "SSF")){
  p <- ggplot(l3, aes(x=factor(SCCBin), y=l3$Cytoplasm_CP_Intensity_MedianIntensity_KRT5Log2))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("KRT5 Median Intensity")+
    ggtitle("KRT5 Intensity in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  p
}

if(ss %in% c("SS3","SS4")){
  p <- ggplot(l3, aes(x=factor(SCCBin), y=l3$Cytoplasm_CP_Intensity_MedianIntensity_KRT19Log2))+
    geom_boxplot(outlier.colour = NA)+
    guides(colour=FALSE)+
    xlab("Spot Cell Count Bins")+
    ylab("KRT19 Median Intensity")+
    ggtitle("KRT19 Intensity in Spots with Similar Cell Counts")+
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
  p <- p +  geom_jitter(aes(colour=ECMp),size=rel(.05),alpha=.05)
  p
}

```

***
The spots cell count bins are labeled by their median cell count. The bins have equal width in the log2 space which results in wider bins in raw cell count space as the cell counts increase.

These boxplots combine all MEP combinations.



###High-Rep Cell Count Distributions by Well and Plate

```{r, fig.width=10, fig.height=7, eval=TRUE}

dt <- l3
p <- ggplot(dt, aes(x=Spot_PA_SpotCellCountLog2, fill=Well))+
  geom_density(alpha=.2)+
  facet_grid(Barcode~Ligand)+
  xlab("Spot Cell Count (log2)")+
  ggtitle("Spot Cell Count Distributions")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
print(p)

```

***
The median of the spot cell counts is `r median(l3$Spot_PA_SpotCellCount)` and the range is `r range(l3$Spot_PA_SpotCellCount)`.


###High-Rep Cell Count Distributions by Well


```{r, fig.width=10, fig.height=7, eval=TRUE}

dt <- l3
p <- ggplot(dt, aes(x=Spot_PA_SpotCellCountLog2, fill=BWL))+
  geom_density(alpha=.2)+
  facet_wrap(~Ligand)+
  xlab("Spot Cell Count")+
  ggtitle("Spot Cell Count Distributions")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
print(p)

```

***

###High-Rep Proliferation by Cell Count Distributions by Well and Plate

```{r, fig.width=10, fig.height=7, eval=TRUE}

dt <- l3
p <- ggplot(dt, aes(x=Nuclei_PA_Gated_EdUPositiveProportionLogitBacktransformed, fill=Well))+
  geom_density(alpha=.2)+
  facet_grid(Barcode~Ligand)+
  coord_cartesian(xlim=c(0,.75))+
  xlab("EdU+ Proportion")+
  ggtitle("Proliferation Distributions")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(1)), axis.text.y = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(1)), plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)))
print(p)

```

***
These density plots show the distributions of the proliferation values in all wells of the plates. 



###Comparing proliferation due to ECM protein in spots with similar cell count and BMP4. 

```{r CompareProliferationSimilarSCCSpots, fig.width=3,fig.height=3, eval=FALSE}
dt <- l3[grepl("573",l3$Barcode),]
dtSCCH <- dt[dt$Spot_PA_SpotCellCount>=(median(dt$Spot_PA_SpotCellCount)),]
dtc <- dcast(dt,EB~Well,fun.aggregate = median, value.var = "Nuclei_PA_Gated_EdUPositiveProportion", fill=NA)

combns <- combn(x=c("A01","A02","A03","A04","B01","B02","B03","B04"),m=2)
for(col in 1:ncol(combns)){
  f <- as.formula(paste0("~",combns[1,col],"+",combns[2,col]))
  p <- pairs(f,data=dtc, main="Correlations of Proliferation\nin Binned Spot Cell Counts",lower.panel = panel.smooth, upper.panel = panel.cor, na.action = na.exclude, cex.main=.5, pch=".", span=1)
  p
}


```


***
This data is from spots in the `r unique(dt$Barcode)` plate which has `r unique(dt$Ligand)` in the wells. The data is the median proportion of cells that are proliferating on spots with the same ECM protein and in the same SCC bin. The absolute value of the pearson correlation is shown in the upper right triangle. High correlation values would provide evidence that there is a repeatable biological mechanism that modulates proliferation. 


###Comparison of MCF10A BMP Validation and MEP-LINCS SS2 Data


```{r EdUCompToMEMA, echo=FALSE, fig.width=9,fig.height=6}
l4l <- l4[,lapply(.SD,numericMedian), by=Ligand, .SDcols=c("Spot_PA_SpotCellCountLog2","Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess","Nuclei_PA_Cycle_DNA2NProportionLogitRUVLoess")]
dt <- merge(MEMArepDT,l4l,by="Ligand")

p <- ggplot(dt, aes(x=btLogit(Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess.x), y=btLogit(Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess.y), colour=Ligand))+
  geom_point(size=5)+
  #facet_wrap(~CellDensity, labeller = "label_both")+
  coord_cartesian(xlim = c(0,.25), ylim=c(0,.25))+
  ggtitle(paste("EdU+ Proportion"))+
  xlab("MEP-LINCS SS2 (Normalized)")+ylab("MCF10A DMSO (Raw)")
 p <- p + geom_abline(slope=1, intercept=0)
ggplotly(p)

p <- ggplot(dt, aes(x=btLogit(Nuclei_PA_Cycle_DNA2NProportionLogitRUVLoess.x), y=btLogit(Nuclei_PA_Cycle_DNA2NProportionLogitRUVLoess.y), colour=Ligand))+
  geom_point(size=5)+
    coord_cartesian(xlim = c(.65,.85), ylim=c(.65,.85))+
  ggtitle(paste("DNA 2n Proportion"))+
  xlab("MEP-LINCS SS2 (Normalized)")+ylab("MCF10A DMSO (Raw)")
print(p)

p <- ggplot(dt, aes(x=Spot_PA_SpotCellCountLog2.x, y=Spot_PA_SpotCellCountLog2.y, colour=Ligand))+
  geom_point(size=5)+
      coord_cartesian(xlim = c(6,8), ylim = c(6,8))+
  ggtitle(paste("Cell Count (log2)"))+
  xlab("MEP-LINCS SS2 (Normalized)")+ylab("MCF10A DMSO (Raw)")
print(p)

```

***
These figures compare the BMP Validation 3 data which is from a ligand-only experiment in tissue culture plates to the MEP-LINCS MEMA data acquired from MEMA arrays in 8 well plates. 
