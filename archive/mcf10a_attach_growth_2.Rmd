---
title: "MCF10A Collagen Growth 2"
author: "Mark Dane"
date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    source_code: embed
---



```{r "setup", include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE)

#Author: Mark Dane, copyright 2015-2017

library(MEMA)
library(ggplot2)
library(stringr)
library(scales)


path <- "/lincs/share/lincs_user/incell96well/study"
studyName <- "MCF10A_Collagen_Growth_2"

```


```{r readWriteLevel3and4Data, echo=FALSE}

l3 <- fread(paste0(path,"/",studyName,"/Annotated/",studyName,"_Level3.tsv"),verbose = FALSE, showProgress = FALSE)
l3$Time <- "T0"
l3$Time[l3$Barcode=="LI9V01706"] <-"T72"
l3$Study <- studyName
l3 <- l3[!grepl("gelatin",l3$ECMp),]
l3 <- l3[!l3$ECMp=="",]

l3$Base <- "COL1"
l3$Base[grepl("PBS",l3$ECM1)] <- "PBS"
l3$MEP_Base <- paste(l3$MEP,l3$Base,sep="_")
l3$PlatingDensity <- 0
l3$PlatingDensity[grepl("A",l3$Well)] <- 25926
l3$PlatingDensity[grepl("B",l3$Well)] <- 17284
l3$PlatingDensity[grepl("C",l3$Well)] <- 11523
l3$PlatingDensity[grepl("D",l3$Well)] <- 7682
l3$PlatingDensity[grepl("E",l3$Well)] <- 5121
l3$PlatingDensity[grepl("F",l3$Well)] <- 3414
l3$PlatingDensity[grepl("G",l3$Well)] <- 2276
l3$PlatingDensity[grepl("H",l3$Well)] <- 1517

l4 <- fread(paste0(path,"/",studyName,"/Annotated/",studyName,"_Level4.tsv"),verbose = FALSE, showProgress = FALSE)

```

###Experiment Overview

```{r  fig.width=6,fig.height=4}
dt <- l3[l3$Time=="T72",]
dt$Well_Ligand <-paste(dt$Well,dt$Ligand,sep="_")
dt$WellRow <- factor(gsub("[[:digit:]]*","",dt$Well),levels = c("H","G","F","E","D","C","B","A"))
dt$WellCol <- as.integer(gsub("[[:alpha:]]","",dt$Well))


p <- ggplot(dt, aes(x=WellCol, y=WellRow, colour=factor(Ligand)))+
  geom_point(size=10)+
  guides(colour = guide_legend("Ligand", keywidth = .5, keyheight = .5))+
  ggtitle(paste("Ligand Layout in",studyName))+
  xlab("")+ylab("")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 5))
p

p <- ggplot(dt, aes(x=WellCol, y=WellRow, colour=PlatingDensity))+
  geom_point(size=10)+
  scale_colour_gradient(low = "white", high = "red")+
  guides(colour = guide_legend("Plating Density", keywidth = .5, keyheight = .5))+
  ggtitle(paste("Plating Density Layout in",studyName))+
  xlab("")+ylab("")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 5))
p

dt <- dt[,WellCellCount := sum(Spot_PA_SpotCellCount), by="Well"]

p <- ggplot(dt, aes(x=WellCol, y=WellRow, colour=WellCellCount))+
  geom_point(size=10)+
scale_colour_gradient(low = "white", high = "red")+
  guides(colour = guide_legend("Well Cell Count", keywidth = .5, keyheight = .5))+
  ggtitle(paste("Well Cell Count in",studyName))+
  xlab("")+ylab("")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 5))
p

```

***
1. This experiment will replicate the plating density experiment to assess the proper cell plating number (+/- EGF) in 96 well MEMA plates. *Note that this experiment differs slightly from the prior cell titration experiment and the prior collagen growth experiment. *Note that the plating density for this experiment and the prior cell titration experiment may not be directly comparable as the spots contain different ECM proteins that may affect relative attachment across a well. 

2. This is also an experiment to test the relative growth of MCF10A cells between spots coated with collagen or collagen and a second ECM protein. We will use cell mask staining to assess any differences in morphology between ECM coatings
<br>
Protocol  
1. Plate cells (175 ul media per well) and allow attachment overnight in experimental media (2x 96-well specially coated plates +/- collagen). One plate will be a T0 plate and the other plate will be a T72 plate. We will plate all 96 wells for both the T0 and the T72 plates. Plate cells at 8 densities. Densities (cells/well) are: 25926 (row A), 17284 (row B), 11523 (row C), 7682 (row D), 5121 (row E), 3414 (row F), 2276 (row G), 1517 (row H). Allow cells to adhere overnight.  
2. Carefully aspirate media to remove non-attached cells and add fresh experimental media +/- EGF 10 ng/ml.  Half the wells will have EGF the other half will just have experimental media. The EGF should result in max proliferation whereas the experimental media should results in minimal proliferation.  
3. Fix time 0 plate. For the time 0 plate we will not pulse with Edu.  
4. Incubate cells for 72 hrs. For the time 72 plate we will not pulse with Edu.  
5. Fix and stain with Dapi and Cell Mask. Staining Set G 

###Results

```{r cellCountLayout, fig.width=12,fig.height=16}
dt <- unique(l3[,.(Well, Ligand, Barcode, ECMp, Time, Spot_PA_SpotCellCount, CellLine, MEP, PlatingDensity)])
dt$Well_Ligand <-paste(dt$Well,dt$Ligand,sep="_")
dt$WellRow <- factor(gsub("[[:digit:]]*","",dt$Well),levels = c("H","G","F","E","D","C","B","A"))
dt$WellCol <- as.integer(gsub("[[:alpha:]]","",dt$Well))

dt1706 <- l3[l3$Barcode=="LI9V01706",]
  p <- ggplot(dt1706, aes(x=ECMp, y=Spot_PA_SpotCellCount, colour=factor(Ligand)))+
 geom_boxplot(fill="transparent", alpha=.5)+
    coord_cartesian(ylim=c(0, 250))+
  guides(colour = guide_legend("Ligand"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count for",unique(dt1706$CellLine), "cells in the T72 Plate"))+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
    facet_wrap(~PlatingDensity,nrow = 8, labeller = "label_both")
 p
 
 dt1706 <- l3[l3$Barcode=="LI9V01706",]
  p <- ggplot(dt1706, aes(x=ECMp, y=Spot_PA_SpotCellCount, colour=factor(Ligand)))+
 geom_boxplot(fill="transparent", alpha=.5)+
  guides(colour = guide_legend("Ligand"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count for",unique(dt1706$CellLine), "cells in the T72 Plate"))+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
    facet_wrap(~PlatingDensity,nrow = 8, scales = "free_y", labeller = "label_both")
 p
 
dt <- unique(l3[,.(Well, Ligand, Barcode, ECMp, Spot_PA_SpotCellCount, CellLine, MEP, PlatingDensity, Time)])
dt$Well_Ligand <-paste(dt$Well,dt$Ligand,sep="_")
dt$WellRow <- factor(gsub("[[:digit:]]*","",dt$Well),levels = c("H","G","F","E","D","C","B","A"))
dt$WellCol <- as.integer(gsub("[[:alpha:]]","",dt$Well))

p <- ggplot(dt, aes(x=MEP, y=Spot_PA_SpotCellCount))+
  geom_boxplot(fill="transparent",  alpha=.5)+
  coord_cartesian(ylim=c(0, 250))+
  guides(colour = guide_legend("Spot Cell Count"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count After Growth for",unique(dt$CellLine), "cells at Time 0 and 72 hours"))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
  facet_grid(PlatingDensity~Time, labeller = "label_both")
p <- p +  geom_jitter(aes(),size=rel(.1),alpha=.2)

p

```

***

These figures summarize the cell counts per spot for each set of replicates. The first figure is for the T72 plate and has a fixed y axis scale for all rows while the second shows the same data with the y axis scaled to the data. The thrid figure shows the T0 and T72 data side-by-side.  

