---
title: "MCF10A Collagen Attach and Growth, CP Pipeline"
author: "Mark Dane"
date: "`r Sys.Date()`"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    source_code: embed
---



```{r "setup", include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8,
                      echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE)

#Author: Mark Dane, copyright 2015-2017

library(MEMA)
library(ggplot2)
library(stringr)
library(scales)


path <- "/lincs/share/lincs_user/study"
studyNameA <- "MCF10A_Collagen_Attach"
studyNameG <- "MCF10A_Collagen_Growth"

```


```{r readWriteLevel3and4Data, echo=FALSE}

l3A <- fread(paste0(path,"/",studyNameA,"/Annotated/",studyNameA,"_Level3.tsv"),verbose = FALSE, showProgress = FALSE)
l3A$Time <- "T0"
l3A$Study <- studyNameA
l3A <- l3A[!grepl("gelatin",l3A$ECMp),]
l3A <- l3A[!l3A$ECMp=="",]
l3G <- fread(paste0(path,"/",studyNameG,"/Annotated/",studyNameG,"_Level3.tsv"),verbose = FALSE, showProgress = FALSE)
l3G$Time <- "T0"
l3G$Time[l3G$Barcode=="LI9V01702"] <-"T72"
l3G$Study <- studyNameG
l3G <- l3G[!grepl("gelatin",l3G$ECMp),]
l3G <- l3G[!l3G$ECMp=="",]

l3 <- rbind(l3A,l3G)

l3$Base <- "COL1"
l3$Base[grepl("PBS",l3$ECM1)] <- "PBS"
l3$MEP_Base <- paste(l3$MEP,l3$Base,sep="_")

```

###Experiment Overview

```{r cellCountLayout, fig.width=12,fig.height=8}


dt <- unique(l3A[,.(Well, Ligand, Barcode, ECMp, Spot_PA_SpotCellCount, CellLine, MEP)])
dt$Well_Ligand <-paste(dt$Well,dt$Ligand,sep="_")
dt$WellRow <- factor(gsub("[[:digit:]]*","",dt$Well),levels = c("H","G","F","E","D","C","B","A"))
dt$WellCol <- as.integer(gsub("[[:alpha:]]","",dt$Well))

# p <- ggplot(l3, aes(x=ArrayColumn, y=ArrayRow, colour=Spot_PA_SpotCellCount))+
#   geom_point(size=rel(2))+
#   scale_y_reverse()+
#   #scale_x_continuous(breaks= c(min(l3$ArrayColumn),round(mean(c(min(l3$ArrayColumn),max(l3$ArrayColumn)))),max(l3$ArrayColumn)))+
#   scale_colour_gradient(low = "white", high = "red")+
#   guides(colour = guide_legend("Spot Cell Count"))+
#   ggtitle(paste("Spot Cell Count for",unique(l3$CellLine), "cells in plate",unique(l3$Barcode)))+
#   xlab("")+ylab("")+theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 5))+
#   facet_grid(Barcode~Well)
#  p


p <- ggplot(dt, aes(x=MEP, y=Spot_PA_SpotCellCount))+
  geom_boxplot(fill="transparent", outlier.colour = NA, alpha=.5)+
  coord_cartesian(ylim=c(0, 400))+
  guides(colour = guide_legend("Spot Cell Count"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Counts for",unique(dt$CellLine), "cells in plate",unique(dt$Barcode)))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))
p <- p +  geom_jitter(aes(),size=rel(.1),alpha=.2)
p

dt <- unique(l3G[,.(Well, Ligand, Barcode, ECMp, Time, Spot_PA_SpotCellCount, CellLine, MEP)])
dt$Well_Ligand <-paste(dt$Well,dt$Ligand,sep="_")
dt$WellRow <- factor(gsub("[[:digit:]]*","",dt$Well),levels = c("H","G","F","E","D","C","B","A"))
dt$WellCol <- as.integer(gsub("[[:alpha:]]","",dt$Well))

p <- ggplot(dt, aes(x=MEP, y=Spot_PA_SpotCellCount))+
  geom_boxplot(fill="transparent", outlier.colour = NA, alpha=.5)+
  coord_cartesian(ylim=c(0, 400))+
  guides(colour = guide_legend("Spot Cell Count"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count After Growth for",unique(dt$CellLine), "cells at Time 0 and 72 hours"))+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
  facet_wrap(~Time)
p <- p +  geom_jitter(aes(),size=rel(.1),alpha=.2)

p

dt <- l3[l3$Barcode=="LI9V01702",]
  p <- ggplot(dt, aes(x=ECMp, y=Spot_PA_SpotCellCount, colour=factor(Ligand)))+
 geom_boxplot(fill="transparent", outlier.colour = NA, alpha=.5)+
    coord_cartesian(ylim=c(0, 400))+
  guides(colour = guide_legend("Ligand"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count for",unique(l3$CellLine), "cells in the T72 Plate"))+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
    facet_wrap(~Base)
 p
 
 dt <- l3[l3$Barcode=="LI9V01702",]
   p <- ggplot(dt, aes(x=ECMp, y=Spot_PA_SpotCellCount, colour=factor(Base)))+
 geom_boxplot(fill="transparent", outlier.colour = NA, alpha=.5)+
  coord_cartesian(ylim=c(0, 400))+
  guides(colour = guide_legend("ECMP Base"))+
  labs(x = "MEP", y="Spot Cell Count",title=paste("Spot Cell Count for",unique(l3$CellLine), "cells in the T72 Plate"))+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size=rel(.8)),axis.title.x = element_text(size=rel(1)),plot.title = element_text(size = rel(1)),legend.text=element_text(size = rel(1)),legend.title=element_text(size = rel(1)), strip.text = element_text(size = 10))+
    facet_wrap(~Ligand)
 p
 
 
```

***
