---
title: "MCF10A Proliferation"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
runtime: shiny
---

```{r global, include=FALSE}
# load data in 'global' chunk so it can be shared by all users of the dashboard
library(readr)
library(ggplot2)
library(plotly)

df <- read_tsv("../Downloads/MCF10A_SS2_Level4.txt")
df <- df[grep("EdUPositiveProportionLogitRUVLoess$|SpotCellCount$|MEP|ECMp$|^Ligand$",colnames(df), value=TRUE)]
```


```{r}
# Reactive that returns the whole dataset if there is no brush
selectedData <- reactive({
  data <- brushedPoints(df, input$profHist_brush, yvar="Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess")
  if (nrow(data) == 0)
    data <- df
  data
})
```

Column {data-width=650}
-----------------------------------------------------------------------

### Proliferation Histogram {data-width=600}

```{r}
plotOutput("profHist", brush = brushOpts(id = "profHist_brush"))
output$profHist <- renderPlot({
  ggplot(df, aes( Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess)) + geom_histogram(binwidth = .01)
})
```


### Proliferation vs. Spot Cell Count {data-width=600}

```{r}
renderPlotly({
  ggplot(selectedData(), aes(Spot_PA_SpotCellCount, Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess, text=MEP))  + geom_point()
})
```

### Proliferation and Ligands

```{r}
renderPlot({
  ggplot(selectedData(), aes(factor(Ligand), Nuclei_PA_Gated_EdUPositiveProportionLogitRUVLoess))  + geom_boxplot()
})
```


Column {data-width=350}
-----------------------------------------------------------------------

### MEP Details {data-width=400}

```{r}
renderTable({
  selectedData()["MEP"]
})
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
